<!DOCTYPE html>
<!-- - add Bootstrap -->
<head>

</head>
<body>
  <!-- best practice for mobile web audio: have the user click a button to begin rather than attempt to autoplay sound -->
  <input type="button" id="enable_audio_button" value="Begin">

  <!-- slider ("range input") is disabled on page load -->
  <input id="crossfade_slider" type="range" min="0" max="1" step="0.01" disabled>

  <!-- Stop button is hidden on page load -->
  <input type="button" id="stop_button" value="Stop" class="hidden">

  <!-- audio engine! docs: https://tonejs.github.io -->
  <script src='./js/Tone.js'></script>
  
  <script type="module">
    import { WebAudioSession } from './js/web-audio-session.js'

    // to avoid weird uses of the word 'cue', let's say we have four episodes. each has the same ambient sound cue and each has a different, second sound cue

    // check the URL to see which episode we should be playing
    const queryParams = new URLSearchParams(document.location.search) // in the URL, this is everything after a question mark, i.e. "https://google.com/stuff?user=Bob" should return the object { user: "Bob" }

    let activeEpisode
    if(!queryParams || !queryParams.get('episode')){ 
      activeEpisode = 1 // in case of trouble, default to episode 1
    } else {
      activeEpisode = queryParams.get('episode')
    }

    console.log("Episode: " + activeEpisode)

    // define episodes and their audio files
    let episodes = [
      {
        episodeLabel: "Episode 1",
        audioAssets:[
          "./sounds/speck_-_It_Takes_Perspective_1.mp3",
          "./sounds/Wonderland_Window-Place.mp3"
        ]
      },{
        episodeLabel: "Episode 2",
        audioAssets:[
          "./sounds/speck_-_It_Takes_Perspective_1.mp3",
          "./sounds/Wonderland_Window-Place.mp3"
        ]
      },{
        episodeLabel: "Episode 3",
        audioAssets:[
          "./sounds/Reiswerk_-_Zona_Norte.mp3",
          "./sounds/Wonderland_Window-Place.mp3"
        ]
      },{
        episodeLabel: "Episode 4",
        audioAssets:[
          "./sounds/speck_-_It_Takes_Perspective_1.mp3",
          "./sounds/Wonderland_Window-Place.mp3"
        ]
      }
    ]
    
    // set up what happens when user interacts with slider
    document.getElementById("crossfade_slider").addEventListener('input', (event) => {
      // console.log(event)
      const value = event.target.value
      WebAudioSession.updateFaderValue(value)
    })

    // set up what happens when user interacts with Begin button
    document.getElementById("enable_audio_button").addEventListener('click', (event) => {
      document.getElementById("enable_audio_button").setAttribute('disabled', " ")
      // console.log(event)
      WebAudioSession
        .enable(episodes[activeEpisode].audioAssets) // pass the list of audio files, in this case only two
        .then( () => {
          document.getElementById("crossfade_slider").removeAttribute('disabled') // enable the slider
          document.getElementById("enable_audio_button").remove() // delete the Begin button
          document.getElementById("stop_button").classList.remove('hidden')
        })
    })

    // set up the Stop button
    document.getElementById("stop_button").addEventListener( 'click', event => {
      WebAudioSession.stopAll()
    })

  </script>
</body>

<style>
  input {
    display: block;
    margin-top: 20px;
    margin-bottom: 20px;
  }

  .hidden {
    visibility: hidden;
  }
</style>
