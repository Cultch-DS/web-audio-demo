<!DOCTYPE html>

<html lang="en"></html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css" />

    <title>Holiday Corner - Winter</title>
</head>
<body>
  <div class="container">
    <div class="row" >  
        <div class="col-sm-offset-2 col-sm-10 mt-4">  
            <img src="https://www.crowstheatre.com/images/logo-alt.png"  height="40px" alt="Crow's theatre logo" > 
        </div> 
    </div>


    <div class="row"> 
        <div class="col-sm-offset-2 col-sm-10">
            <hr/>
        </div>               
    </div>

    <div class="row">
        <div class="col-sm-offset-2 col-sm-10 mb-4">
            <h1> Holiday Corner - Winter</h1>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-offset-2 col-sm-10 mb-4">
            <!-- best practice for mobile web audio: have the user click a button to begin rather than attempt to autoplay sound -->
            <input class="btn btn-outline-light btn-lg font-weight-bold" type="button" id="enable_audio_button" value="Begin">
            <!-- Stop button is hidden on page load -->
            <input class="btn btn-outline-light btn-lg font-weight-bold"type="button" id="stop_button" value="Stop" class="hidden">
        </div>
    </div>
    
    <div class="row">
        <div class="col-sm-offset-2 col-sm-10">
          <form>
            <div class="form-group">
              <label for="crossfade_slider" class="float-left h4">Ambience</label> 
              <label for="" class="float-right h4">Music</label>
              <!-- slider ("range input") is disabled on page load -->
              <input  class="form-control-range" id="crossfade_slider" type="range" min="0" max="1" step="0.01" disabled>
            </div>
          </form>
        </div>    
    </div>
  </div>

  <!-- audio engine! docs: https://tonejs.github.io -->
  <script src='./js/Tone.js'></script>
  
  <script type="module">
    import { WebAudioSession } from './js/web-audio-session.js'


    // to avoid weird uses of the word 'cue', let's say we have four episodes. each has the same ambient sound cue and each has a different, second sound cue

    // check the URL to see which episode we should be playing
    const queryParams = new URLSearchParams(document.location.search) // in the URL, this is everything after a question mark, i.e. "https://google.com/stuff?user=Bob" should return the object { user: "Bob" }

    let activeEpisode
    if(!queryParams || !queryParams.get('episode')){ 
      activeEpisode = 1 // in case of trouble, default to episode 1
    } else {
      activeEpisode = queryParams.get('episode')
    }

    console.log("Episode: " + activeEpisode)

    // define episodes and their audio files
    let episodes = [
      {
        episodeLabel: "Episode 1",
        audioAssets:[
          "./sounds/HC-Winter-Amb-1Test-short1.mp3",
          "./sounds/Wonderland-Scene1-2.0M-Winter.mp3"
        ]
      },{
        episodeLabel: "Episode 2",
        audioAssets:[
          "./sounds/HC-Winter-Amb-1Test-short.mp3",
          "./sounds/Wonderland_Window-Place.mp3"
        ]
      },{
        episodeLabel: "Episode 3",
        audioAssets:[
          "./sounds/HC-Winter-Amb-1Test-short.mp3",
          "./sounds/Wonderland-Scene3-2.5MThePlace.mp3"
        ]
      },{
        episodeLabel: "Episode 4",
        audioAssets:[
          "./sounds/HC-Winter-Amb-1Test-short.mp3",
          "./sounds/Wonderland-Scene4-2M-Spring.mp3"
        ]
      }

    ]
    
    // set up what happens when user interacts with slider
    document.getElementById("crossfade_slider").addEventListener('input', (event) => {
      // console.log(event)
      const value = event.target.value
      WebAudioSession.updateFaderValue(value)
    })

    // set up what happens when user interacts with Begin button
    document.getElementById("enable_audio_button").addEventListener('click', (event) => {
      document.getElementById("enable_audio_button").setAttribute('disabled', " ")
      // console.log(event)
      WebAudioSession
        .enable(episodes[activeEpisode].audioAssets) // pass the list of audio files, in this case only two
        .then( () => {
          document.getElementById("crossfade_slider").removeAttribute('disabled') // enable the slider
          document.getElementById("enable_audio_button").remove() // delete the Begin button
          document.getElementById("stop_button").classList.remove('hidden')
        })
    })

    // set up the Stop button
    document.getElementById("stop_button").addEventListener( 'click', event => {
      WebAudioSession.stopAll()
    })

  </script>
</body>

<style>
  input {
    display: block;
    margin-top: 20px;
    margin-bottom: 20px;
  }


  .hidden {
    visibility: hidden;
  }

</style>
